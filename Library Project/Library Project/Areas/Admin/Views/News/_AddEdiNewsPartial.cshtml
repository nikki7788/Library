
@model News

<form method="post" enctype="multipart/form-data">

    <!--برای اینکه چند پارشال میخوهیم همزمان اجرا شود-->
    <!--Modal header-->
    @if (Model.NewsId != 0)
    {
        @await Html.PartialAsync("_ModalHeaderPartial", new ModalHeader { Heading = "ویرایش خبر" })
    }
    else
    {
        @await Html.PartialAsync("_ModalHeaderPartial", new ModalHeader { Heading = "افزودن خبر" })
    }

    @Html.AntiForgeryToken()    <!--insed of [ValidateAntiForgeryToken]  in action -->
    <!--Modal body-->
    <div class="modal-body">
        <div class="form-group row ">
            <label asp-for="NewsTitle" class="col-lg-3 col-sm-4 col-12 text-lg-center col-form-label"></label>
            <div class="col-lg-8 col-sm-6 col-12">
                <input asp-for="NewsTitle" class=" form-control" />
                <span asp-validation-for="NewsTitle" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row ">
            <label asp-for="NewsContent" class="col-3 col-form-label text-lg-center"></label>
            <div class="col-lg-8 col-sm-6 col-12 ">
                <textarea asp-for="NewsContent" id="NewsContent" name="NewsContent" class="form-control"></textarea>
                <span asp-validation-for="NewsContent" class="text-danger"></span>
                <script type="text/javascript">
                    var myEditor;
                    ClassicEditor
                        .create(document.querySelector('#NewsContent'))
                        .then(editor => {
                            console.log(editor);
                            myEditor = editor;
                        })
                        .catch(error => {
                            console.error(error);
                        });
                </script>
            </div>
        </div>

        <div class="form-group row ">
            <label asp-for="NewsDate" class="col-lg-3 col-sm-4 col-12 text-lg-center col-form-label"></label>
            <div class="col-lg-8 col-sm-6 col-12">
                <input asp-for="NewsDate" class="form-control" value="@ViewBag.pDate" readonly />
            </div>

        </div>
        <div class="form-group row">
            <label asp-for="NewsImage" class="col-lg-3 col-sm-4 col-12  col-form-label text-lg-center"></label>
            <div class="col-lg-8 col-sm-6 col-12">
                <input type="file" id="files" name="files" class="form-control-file" />
                <div class="mt-3" id="image-holder">

                    <!--eidting-->
                    @if (Model.NewsId != 0)
                    {
                        <img src="@ViewData["imgRoot"]@Model.NewsImage" alt="newsImage" class="img-fluid img-thumbnail"
                             style="border:1px solid gray;width:150px;height:150px " />
                        <input type="hidden" name="imgName" value="@Model.NewsImage" />
                    }
                </div>
            </div>
        </div>

        <!--برای عملیات پست کردن اطلاعات به ای دی نیاز است-->
        <div class="form-group row d-none">
            <label asp-for="NewsId" class="col-lg-3 col-sm-3 col-form-label"></label>
            <div class="col-6">
                <input asp-for="NewsId" class=" form-control" />
                <span asp-validation-for="NewsId"></span>
            </div>
        </div>
        <!--مقدار دهی متغیر ورودی اکشن-->
        <input type="hidden" name="redirectUrl" value="@Url.Action("Index","News")" />

    </div>

    <!--Modal Footer-->
    @if (Model.NewsId != 0)
    {
        //  @await Html.PartialAsync("_ModalFooterPartial", new ModalFooter { SubmitButtonText = "ویرایش کتاب" })
        <div class="modal-footer">
            <button type="button" class="btn ml-2" data-dismiss="modal">برگشت </button>
            <input type="button" id="submitdata" value="ویرایش خبر" class="btn btn-success" />

        </div>
    }
    else
    {
        //  @await Html.PartialAsync("_ModalFooterPartial", new ModalFooter { SubmitButtonText = "افزودن کتاب" })
        <div class="modal-footer">
            <button type="button" class="btn ml-2" data-dismiss="modal">برگشت </button>
            <input type="button" id="submitdata" value="افزودن خبر" class="btn btn-success" />

        </div>
    }
</form>

<script>
    //پیش نمایش تصویر قبل از اپلود
    $(document).ready(function () {

        $("#files").on('change', function () {
            if (typeof (FileReader) != "undefined") {
                var image_holder = $("#image-holder");
                image_holder.empty();
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("<img />", {
                        "src": e.target.result,
                        "class": "img-fluid",
                        "style": "width:150px;height:150px;border:solid 1px"
                    }).appendTo(image_holder);
                }
                image_holder.show();
                reader.readAsDataURL($(this)[0].files[0]);
            } else {
                alert("This browser does not support FileReader.");
            }
        });
    });
</script>